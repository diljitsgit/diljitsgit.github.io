---
import fs from "fs";
import matter from "gray-matter";
import path from "path";
import BlogPostCard from "../components/BlogPostCard.tsx";
import Footer from "../components/Footer.tsx";
import Navbar from "../components/Navbar.tsx";

import "../styles/global.css";

const blogDir = path.resolve("./src/content/blog");

const files = fs.readdirSync(blogDir).filter((f) => f.endsWith(".mdx"));

interface BlogPost {
    slug: string;
    title: string;
    date: string;
    excerpt: string;
    tags?: string[];
}

const posts: BlogPost[] = files
    .map((file) => {
        const content = fs.readFileSync(path.join(blogDir, file), "utf-8");
        const { data, content: body } = matter(content);
        const excerpt =
            body
                .split("\n")
                .find((line) => line.trim() !== "")
                ?.slice(0, 150) ?? "";
        return {
            slug: file.replace(/\.mdx$/, ""),
            title: data.title,
            date: data.date,
            excerpt,
            tags: data.tags ?? [],
        };
    })
    .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());

console.log(posts);
---

<html>
    <body>
        <Navbar />
        <main class="p-8 max-w-4xl mx-auto">
            <h1 class="text-3xl font-bold mb-6">Blog</h1>
            <div class="space-y-6">
                {
                    posts.map((post) => (
                        <BlogPostCard
                            key={post.slug}
                            slug={post.slug}
                            title={post.title}
                            date={post.date}
                            excerpt={post.excerpt}
                        />
                    ))
                }
            </div>
        </main>
        <Footer />
    </body>
</html>
